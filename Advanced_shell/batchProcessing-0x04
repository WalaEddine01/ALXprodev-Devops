#!/bin/bash

# Pokémon list
POKEMONS=(bulbasaur ivysaur venusaur charmander charmeleon)
mkdir -p pokemon_data

# Array to keep track of PIDs
PIDS=()

# Fetch function
fetch_pokemon() {
    local NAME=$1
    curl -s "https://pokeapi.co/api/v2/pokemon/${NAME}" -o "pokemon_data/${NAME}_parallel.json" \
        || echo "Failed to fetch $NAME" >> errors.txt
}

# Launch all in background
for NAME in "${POKEMONS[@]}"; do
    echo "Fetching $NAME..."
    fetch_pokemon "$NAME" &
    PIDS+=($!)
done

# Print jobs for visibility
jobs

# Optional: if you want to handle process failures manually
for PID in "${PIDS[@]}"; do
    if ! kill -0 "$PID" 2>/dev/null; then
        echo "Process $PID not running" >> errors.txt
    fi
done

# Wait for all background jobs
wait

echo "✅ All parallel fetches complete."
